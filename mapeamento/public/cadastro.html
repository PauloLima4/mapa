<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro de Empreendedor</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />
  <link rel="stylesheet" href="style.css" />
  <style>
    form {
      max-width: 600px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="url"],
    input[type="email"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 1em;
    }
    textarea {
      resize: vertical;
    }
    #map {
      height: 300px;
      margin-top: 10px;
      border-radius: 4px;
    }
    button {
      margin-top: 20px;
      padding: 12px 20px;
      background-color: #2d89ef;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.1em;
      cursor: pointer;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <header>
    <h1>Cadastro de Empreendedor</h1>
    <button onclick="window.location.href='index.html'">Voltar</button>
  </header>

  <form id="cadastroForm">
    <label for="nome">Nome do negócio *</label>
    <input type="text" id="nome" name="nome" required />

    <label for="categoria">Categoria *</label>
    <select id="categoria" name="categoria" required>
      <option value="">Selecione...</option>
      <option value="Alimentação">Alimentação</option>
      <option value="Moda">Moda</option>
      <option value="Serviços">Serviços</option>
      <option value="Tecnologia">Tecnologia</option>
      <option value="Saúde">Saúde</option>
      <option value="Outro">Outro</option>
    </select>

    <label for="imagem">URL da Foto/Logo *</label>
    <input
      type="url"
      id="imagem"
      name="imagem"
      placeholder="https://exemplo.com/logo.png"
      required
    />

    <label for="descricao">Descrição curta *</label>
    <textarea
      id="descricao"
      name="descricao"
      rows="3"
      placeholder="Descreva brevemente o negócio"
      required
    ></textarea>

    <label>Localização no mapa *</label>
    <div id="map"></div>
    <input type="hidden" id="lat" name="lat" required />
    <input type="hidden" id="lng" name="lng" required />

    <label for="endereco">Endereço (opcional)</label>
    <input type="text" id="endereco" name="endereco" placeholder="Rua, número, bairro..." />

    <label for="email">Email *</label>
    <input type="email" id="email" name="email" placeholder="exemplo@dominio.com" required />

    <label for="telefone">Telefone *</label>
    <input type="text" id="telefone" name="telefone" placeholder="(xx) xxxx-xxxx" required />

    <label for="whatsapp">WhatsApp (opcional)</label>
    <input type="text" id="whatsapp" name="whatsapp" placeholder="(xx) 9xxxx-xxxx" />

    <label for="instagram">Instagram (opcional)</label>
    <input type="text" id="instagram" name="instagram" placeholder="@usuario" />

    <label>Dias de funcionamento *</label>
<div id="diasFuncionamento" style="display:flex; gap:10px; flex-wrap: wrap;">
  <label><input type="checkbox" name="dias" value="Segunda" /> Seg</label>
  <label><input type="checkbox" name="dias" value="Terça" /> Ter</label>
  <label><input type="checkbox" name="dias" value="Quarta" /> Qua</label>
  <label><input type="checkbox" name="dias" value="Quinta" /> Qui</label>
  <label><input type="checkbox" name="dias" value="Sexta" /> Sex</label>
  <label><input type="checkbox" name="dias" value="Sábado" /> Sáb</label>
  <label><input type="checkbox" name="dias" value="Domingo" /> Dom</label>
</div>

<label>Horário de funcionamento *</label>
<div style="display:flex; gap:10px;">
  <input type="time" id="horaInicio" name="horaInicio" required />
  <input type="time" id="horaFim" name="horaFim" required />
</div>


    <label>
      <input type="checkbox" id="lojaVirtualCheck" name="lojaVirtualCheck" />
      Tenho uma loja virtual
    </label>

    <label for="linkLojaVirtual" style="display:none" id="labelLinkLoja">
      Link da loja virtual
    </label>
    <input
      type="url"
      id="linkLojaVirtual"
      name="linkLojaVirtual"
      placeholder="https://lojaexemplo.com"
      style="display:none"
    />

    <button type="submit">Cadastrar</button>
  </form>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Inicializar o mapa centrado em General Sampaio - CE
    const centro = [-4.0432, -39.4545];
    const map = L.map("map").setView(centro, 14);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    // Marcador para a localização escolhida (invisível até o usuário clicar)
    let marker;

    map.on("click", (e) => {
      const { lat, lng } = e.latlng;
      if (marker) {
        marker.setLatLng(e.latlng);
      } else {
        marker = L.marker(e.latlng).addTo(map);
      }
      document.getElementById("lat").value = lat;
      document.getElementById("lng").value = lng;
    });

    // Mostrar/ocultar campo link loja virtual
    const lojaCheck = document.getElementById("lojaVirtualCheck");
    const linkLojaInput = document.getElementById("linkLojaVirtual");
    const labelLinkLoja = document.getElementById("labelLinkLoja");

    lojaCheck.addEventListener("change", () => {
      if (lojaCheck.checked) {
        linkLojaInput.style.display = "block";
        labelLinkLoja.style.display = "block";
        linkLojaInput.required = true;
      } else {
        linkLojaInput.style.display = "none";
        labelLinkLoja.style.display = "none";
        linkLojaInput.required = false;
        linkLojaInput.value = "";
      }
    });

    // Enviar formulário
    document.getElementById("cadastroForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const diasSelecionados = Array.from(document.querySelectorAll('input[name="dias"]:checked')).map(c => c.value);

  const data = {
    nome: e.target.nome.value.trim(),
    categoria: e.target.categoria.value,
    imagem: e.target.imagem.value.trim(),
    descricao: e.target.descricao.value.trim(),
    lat: parseFloat(e.target.lat.value),
    lng: parseFloat(e.target.lng.value),
    endereco: e.target.endereco.value.trim(),
    email: e.target.email.value.trim(),
    telefone: e.target.telefone.value.trim(),
    whatsapp: e.target.whatsapp.value.trim(),
    instagram: e.target.instagram.value.trim(),
    horarioInicio: e.target.horaInicio.value,
    horarioFim: e.target.horaFim.value,
    diasFuncionamento: diasSelecionados,
    atendimento: "fisico", // Você pode adaptar para um select, se quiser
    lojaVirtual: e.target.lojaVirtualCheck.checked,
    linkLojaVirtual: e.target.linkLojaVirtual.value.trim(),
    fotosExtras: [] // vazio por enquanto, pode implementar upload depois
  };

  if (!data.lat || !data.lng) {
    alert("Por favor, clique no mapa para marcar a localização.");
    return;
  }

  try {
    const res = await fetch("http://localhost:3000/api/empreendedores", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data),
    });

    if (res.ok) {
      alert("Cadastro realizado com sucesso!");
      window.location.href = "index.html";
    } else {
      const error = await res.json();
      alert("Erro ao cadastrar: " + (error.error || "Tente novamente."));
    }
  } catch (err) {
    alert("Erro de conexão. Tente novamente mais tarde.");
  }
});
  </script>
</body>
</html>
